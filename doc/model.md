```plantuml
scale 0.8

```

## 判定条件

|バックアップ元|バックアップ先|差分|判定結果    |
|--------------|--------------|----|------------|
|あり          |あり          |なし|何もしない  |
|あり          |あり          |あり|バックアップ|
|あり          |なし          |-   |バックアップ|
|なし          |あり          |-   |バックアップ|
|なし          |なし          |-   |-           |

## バックアップ方法

- ファイル
    - バックアップ先にファイルがある場合
        - バックアップ先のファイルをリネーム
            - ベース名の末尾に `#yyyyMMdd-HHmmssSSS` を付ける
            - 日時はバックアップを実行したときのシステム日時
            - 例 `foo.txt` -> `foo#20230307-121314555.txt`
        - 世代数を制限している場合は、制限を超える古いファイルを削除する
            - 新旧の比較はファイル名に付けた日時で判定
    - バックアップ元のファイルをバックアップ先にコピー
        - バックアップ元にファイルが無い場合は何もしない(削除されたケース)
- ディレクトリ
    - バックアップ先にディレクトリがない場合
        - バックアップ元のディレクトリを丸ごとコピー
    - バックアップ先にディレクトリがある場合
        - 中身を再帰的に判定

## 差分の判定方法

- ファイルは SHA-1 でハッシュ値を取って比較する
- バックアップ先の最新のファイルはハッシュ値を保存しておく
    - ファイルパスからハッシュ値を一意に特定できる仕組みが必要

## 走査方法

- バックアップ元のディレクトリを再帰的に走査していく
- バックアップ先にあるファイルで、前述の走査で処理されなかったものに対して、変更の有無を判定していく

